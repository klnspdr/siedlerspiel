<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Siedler Config Helper</title>
</head>
<body>
<style>
    body {
        font-family: sans-serif;
    }

    .table_component {
        overflow: auto;
        width: 50%;
    }

    .table_component table {
        border: 1px solid #dededf;
        height: 100%;
        width: 100%;
        table-layout: auto;
        border-collapse: collapse;
        border-spacing: 1px;
        text-align: left;
    }

    .table_component caption {
        caption-side: top;
        text-align: left;
    }

    .table_component th {
        border: 1px solid #dededf;
        background-color: #eceff1;
        color: #000000;
        padding: 5px;
    }

    .table_component td {
        border: 1px solid #dededf;
        background-color: #ffffff;
        color: #000000;
        padding: 5px;
    }

    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }

    /* Style the buttons that are used to open the tab content */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
        background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #ccc;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
    }
</style>
<button onclick="loadConfig()">Reload Config</button>
<input type="text" hidden="" name="lastTab" id="lastTab">
<div class="tab">
    <button class="tablinks" id="ItemsButton" onclick="openTab('Items')">Items</button>
    <button class="tablinks" id="ActionsButton" onclick="openTab('Actions')">Actions</button>
    <button class="tablinks" id="GroupsButton" onclick="openTab('Groups')">Groups</button>

</div>

<div id="Items" class="tabcontent">
    <h3>Items</h3>
    <p>ItemNr: <input type="text" maxlength="3" name="itemNr" id="itemNrInput" onkeyup="onItemChange()"><button onclick="decrease('itemNrInput')">-</button><button onclick="increase('itemNrInput', 'number_items')">+</button> </p>
    <div id="itemOutput"></div>
</div>

<div id="Actions" class="tabcontent">
    <h3>Actions</h3>
    <p>ActionNr: <input type="text" maxlength="3" name="itemNr" id="actionNrInput" onkeyup="onActionChange()"><button onclick="decrease('actionNrInput')">-</button><button onclick="increase('actionNrInput', 'number_actions')">+</button> </p>
    <div id="actionOutput"></div>
</div>
<div id="Groups" class="tabcontent">
    <h3>Groups</h3>
    <button onclick="loadGroups()">(Re)Load Groups</button>
    <div id="groupsOutput"></div>
</div>


<div class="actionTab"></div>
<script>
    let config = {}

    function openTab(tabName) {
        // Declare all variables
        var i, tabcontent, tablinks;

        // Get all elements with class="tabcontent" and hide them
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        // Get all elements with class="tablinks" and remove the class "active"
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        // Show the current tab, and add an "active" class to the button that opened the tab
        document.getElementById(tabName).style.display = "block";
        document.getElementById("lastTab").value = tabName
        document.getElementById(`${tabName}Button`).className += " active";
    }

    function loadConfig() {
        fetch('./config/config.json')
            .then((response) => response.json())
            .then((json) => config = json)
    }

    function loadGroups() {
        let output = ""
        for (let i = 1; i <= config.number_groups; i++) {
            const key = `gr${i}`
            console.log(key)
                    output += `
                        <div class="table_component" role="region" tabindex="0">
                        <table>
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Name</td>
                                <td>${config.group_names[key]}</td>
                            </tr>
                            <tr>
                                <td>Image File</td>
                                <td>${config.group_images.files[key]}</td>
                            </tr>
                            <tr>
                                <td>Image</td>
                                <td><img src="../${config.group_icon_dir}/${config.group_images.files[key]}" height="100px"/></td>
                            </tr>
                            <tr>
                                <td>Name Text Color</td>
                                <td style='background="${config.group_colors.nameText[key]};"'>${config.group_colors.nameText[key]}</td>
                            </tr>
                            <tr>
                                <td>Main Color</td>
                                <td style='background="${config.group_colors.main[key]};"'>${config.group_colors.main[key]}</td>
                            </tr>
                             <tr>
                                <td>Outline Color</td>
                                <td style='background="${config.group_colors.outline[key]};"'>${config.group_colors.outline[key]}</td>
                            </tr>
                             <tr>
                                <td>Position</td>
                                <td><ul>
                                <li>x: ${config.group_positions[key].x}</li>
                                <li>y: ${config.group_positions[key].y}</li>

</ul></td>
                            </tr>
                             <tr>
                                <td>Inventory Direction</td>
                                <td>${config.inventoryDirections[key]}</td>
                            </tr>
</tbody>
</table>
                        </div><br><br>`
                    console.log("groups generated")
                }
        document.getElementById("groupsOutput").innerHTML = output
        console.log("groups output done")


    }

    function onItemChange() {
        const itemNr = `item${document.getElementById("itemNrInput").value}`
        console.log("loading item Nr " + itemNr)

        const itemConfig = config[itemNr]
        let output = ""
        if (itemConfig) {
            output = `
                    <h4>Info</h4>
                    <div class="table_component" role="region" tabindex="0">
                    <table>
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Name</td>
                                <td>${itemConfig.name}</td>
                            </tr>
                            <tr>
                                <td>Iconfile</td>
                                <td>${itemConfig.icon_file_name}</td>
                            </tr>
                            <tr>
                                <td>Icon</td>
                                <td><img src="../${config.icon_file_dir}/${itemConfig.icon_file_name}" height="100px"/></td>
                            </tr>
                        </tbody>
                   </table>
                   </div>
                    <h4>Error Messages:</h4>
                    <div class="table_component" role="region" tabindex="0">
                    <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Message</th>
                        </tr>
                        </thead>`
            if (config.error_messages[itemNr]) {
                console.log(Object.keys(config.error_messages[itemNr]))
                for (let key of Object.keys(config.error_messages[itemNr])) {
                    console.log(key)
                    output += `<tr>
                                <td>${key}</td>
                                <td>${config.error_messages[itemNr][key]}</td>
                            </tr>`
                }
            }
            output += `</tbody></table></div>
                   <h4>Log Messages:</h4>
                   <div class="table_component" role="region" tabindex="0">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody>`
            if (config.log_messages[itemNr]) {
                for (let key of Object.keys(config.log_messages[itemNr])) {
                    output += `<tr>
                                <td>${key}</td>
                                <td>${config.log_messages[itemNr][key]}</td>
                            </tr>`
                }
            }
            output += `</tbody></table></div>`

        } else {
            output = "<b>No Item Found</b>"
        }
        document.getElementById("itemOutput").innerHTML = output
    }

    function onActionChange() {
        const actionNr = `action${document.getElementById("actionNrInput").value}`
        console.log("loading action Nr " + actionNr)

        const actionConfig = config[actionNr]
        let output = ""
        if (actionConfig) {
            output = `
                    <h4>Info</h4>
                    <div class="table_component" role="region" tabindex="0">
                    <table>
                        <thead>
                            <tr>
                                <th>Field</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>`
            for (let key of Object.keys(actionConfig)) {

                output += `<tr>
                    <td> ${key}</td>
                    <td>${getActionFieldValue(actionConfig, key)}</td>
                </tr>
            `
            }
            output += `</tbody>
                   </table>
                   </div>
                   <h4>Error Messages:</h4>
                    <div class="table_component" role="region" tabindex="0">
                    <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Message</th>
                        </tr>
                        </thead>`

            if (config.error_messages[actionNr]) {
                console.log(Object.keys(config.error_messages[actionNr]))
                for (let key of Object.keys(config.error_messages[actionNr])) {
                    console.log(key)
                    output += `<tr>
                                <td>${key}</td>
                                <td>${config.error_messages[actionNr][key]}</td>
                            </tr>`
                }
            }
            output += `</tbody></table></div>
                   <h4>Log Messages:</h4>
                   <div class="table_component" role="region" tabindex="0">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody>`
            if (config.log_messages[actionNr]) {
                for (let key of Object.keys(config.log_messages[actionNr])) {
                    output += `<tr>
                                <td>${key}</td>
                                <td>${config.log_messages[actionNr][key]}</td>
                            </tr>`
                }
            }
            output += `</tbody></table></div>`

        } else {
            output = "<b>No Action Found</b>"
        }
        document.getElementById("actionOutput").innerHTML = output
    }

    function getActionFieldValue(actionConfig, key) {
        switch (typeof actionConfig[key]) {
            case "string":
                return (actionConfig[key].includes("item")) ? config[actionConfig[key]].name + " (" + actionConfig[key] + ")" : actionConfig[key]
            case "object":
                console.log(key)
                let returnVal = "<ul>"
                for (let key2 of Object.keys(actionConfig[key])) {
                    console.log(key)
                    returnVal += `<li>${(key2.includes("item")) ? config[key2].name + " (" + key2 + ")" : key2}: ${actionConfig[key][key2]}</li>`
                }
                returnVal += "</ul>"
                return returnVal
            default:
                return actionConfig[key]
        }
    }

    function increase(target, maxKey){
        if(document.getElementById(target).value == ""){
            document.getElementById(target).value = 1
        }
        document.getElementById(target).value =  parseInt(document.getElementById(target).value) + 1
        if(document.getElementById(target).value > config[maxKey]){
            document.getElementById(target).value = config[maxKey]
        }
        switch (target){
            case "itemNrInput":
                onItemChange()
                break;
            case "actionNrInput":
                onActionChange()
                break
            default:
                break
        }
    }

    function decrease(target){
        document.getElementById(target).value =  parseInt(document.getElementById(target).value) - 1
        if(document.getElementById(target).value <= 1){
            document.getElementById(target).value = 1
        }
        switch (target){
            case "itemNrInput":
                onItemChange()
                break;
            case "actionNrInput":
                onActionChange()
                break
            default:
                break
        }
    }

    loadConfig()
    setTimeout(onItemChange, 200)
    setTimeout(onActionChange, 300)
    setTimeout(loadGroups, 300)

    openTab(document.getElementById("lastTab").value)
</script>
</body>
</html>